DROP DATABASE TrofeoRector;
CREATE DATABASE TrofeoRector;
USE TrofeoRector;

CREATE TABLE miembro (
    dni VARCHAR(10) PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    fecha_nacimiento DATE NOT NULL,
    localidad VARCHAR(50) NOT NULL,
    provincia VARCHAR(50) NOT NULL,
    pais VARCHAR(50) NOT NULL
);

CREATE TABLE facultad (
    id_facultad INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(100) UNIQUE NOT NULL,
    ano_apertura YEAR NOT NULL,
    direccion VARCHAR(200) NOT NULL
);

CREATE TABLE colegio_mayor (
    id_colegio INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(100) NOT NULL,
    ano_apertura YEAR NOT NULL,
    direccion VARCHAR(200) NOT NULL
);

CREATE TABLE estudiante (
    dni VARCHAR(10) PRIMARY KEY,
    tui VARCHAR(20) UNIQUE NOT NULL,
    id_facultad INT NOT NULL,
    id_colegio INT,
    FOREIGN KEY(dni) REFERENCES miembro(dni),
    FOREIGN KEY(id_facultad) REFERENCES facultad(id_facultad),
    FOREIGN KEY(id_colegio) REFERENCES colegio_mayor(id_colegio)
);

CREATE TABLE profesor (
    dni VARCHAR(10) PRIMARY KEY,
    tipo_contrato VARCHAR(50) NOT NULL,
    salario DECIMAL(10,2) NOT NULL,
    departamento VARCHAR(100) UNIQUE NOT NULL,
    FOREIGN KEY(dni) REFERENCES miembro(dni)
);

CREATE TABLE staff (
    dni VARCHAR(10) PRIMARY KEY,
    tipo_contrato VARCHAR(50) NOT NULL,
    sueldo DECIMAL(10,2) NOT NULL,
    FOREIGN KEY(dni) REFERENCES miembro(dni)
);

CREATE TABLE profesor_facultad (
    dni_profesor VARCHAR(10),
    id_facultad INT,
    PRIMARY KEY(dni_profesor, id_facultad),
    FOREIGN KEY(dni_profesor) REFERENCES profesor(dni),
    FOREIGN KEY(id_facultad) REFERENCES facultad(id_facultad)
);

CREATE TABLE deporte (
    id_deporte INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(50) NOT NULL,
    max_jugadores INT NOT NULL,
    min_jugadores INT NOT NULL
);

CREATE TABLE equipo (
    id_equipo INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(100) NOT NULL,
    curso_inscripcion YEAR NOT NULL,
    id_centro_facultad INT NOT NULL,
    id_centro_colegio INT NOT NULL,
    FOREIGN KEY(id_centro_facultad) REFERENCES facultad(id_facultad),
    FOREIGN KEY(id_centro_colegio) REFERENCES colegio_mayor(id_colegio)
);

CREATE TABLE torneo (
    id_torneo INT PRIMARY KEY AUTO_INCREMENT,
    ano YEAR NOT NULL,
    id_deporte INT NOT NULL,
    max_equipos INT NOT NULL,
    min_equipos INT NOT NULL,
    id_equipo_ganador INT,
    FOREIGN KEY(id_deporte) REFERENCES deporte(id_deporte),
    FOREIGN KEY(id_equipo_ganador) REFERENCES equipo(id_equipo)
);




CREATE TABLE equipo_miembro (
    id_equipo INT,
    dni_estudiante VARCHAR(10),
    es_capitan BOOLEAN DEFAULT FALSE,
    PRIMARY KEY(id_equipo, dni_estudiante),
    FOREIGN KEY(id_equipo) REFERENCES equipo(id_equipo),
    FOREIGN KEY(dni_estudiante) REFERENCES estudiante(dni)
);

CREATE TABLE torneo_equipo (
    id_torneo INT,
    id_equipo INT,
    PRIMARY KEY(id_torneo, id_equipo),
    FOREIGN KEY(id_torneo) REFERENCES torneo(id_torneo),
    FOREIGN KEY(id_equipo) REFERENCES equipo(id_equipo)
);

CREATE TABLE torneo_arbitros (
    id_torneo INT,
    dni_staff VARCHAR(10),
    PRIMARY KEY(id_torneo, dni_staff),
    FOREIGN KEY(id_torneo) REFERENCES torneo(id_torneo),
    FOREIGN KEY(dni_staff) REFERENCES staff(dni)
);

CREATE TABLE partido (
    id_partido INT PRIMARY KEY AUTO_INCREMENT,
    id_torneo INT NOT NULL,
    ubicacion VARCHAR(150) NOT NULL,
    dni_arbitro VARCHAR(10) NOT NULL,
    resultado VARCHAR(20) NOT NULL,
    id_equipo_ganador INT NOT NULL,
foreign key (id_torneo,dni_arbitro) references torneo_arbitros(id_torneo,dni_staff),
    FOREIGN KEY(id_equipo_ganador) REFERENCES equipo(id_equipo)
);

CREATE TABLE partido_equipo (
    id_partido INT,
    id_equipo INT,
    PRIMARY KEY(id_partido, id_equipo),
    FOREIGN KEY(id_partido) REFERENCES partido(id_partido),
    FOREIGN KEY(id_equipo) REFERENCES equipo(id_equipo)
);



INSERT INTO miembro VALUES
('11111111A', 'Ana López', '1999-04-15', 'Granada', 'Granada', 'España'),
('22222222B', 'Luis Pérez', '1998-11-20', 'Málaga', 'Málaga', 'España'),
('33333333C', 'Marta Ruiz', '1980-02-10', 'Sevilla', 'Sevilla', 'España'),
('44444444D', 'Carlos Gómez', '1975-07-05', 'Córdoba', 'Córdoba', 'España'),
('55555555E', 'Laura Torres', '1997-09-12', 'Jaén', 'Jaén', 'España'),
('66666666F', 'Pedro Sánchez', '1985-06-08', 'Almería', 'Almería', 'España');

INSERT INTO facultad (nombre, ano_apertura, direccion) VALUES
('Facultad de Ingeniería', 1990, 'Av. del Conocimiento 12'),
('Facultad de Medicina', 1980, 'Calle Salud 45'),
('Facultad de Ciencias', 1975, 'Paseo de la Ciencia 33');

INSERT INTO colegio_mayor (nombre, ano_apertura, direccion) VALUES
('Colegio Mayor Albaicín', 1985, 'Calle Universidad 10'),
('Colegio Mayor Fuentenueva', 1995, 'Av. Fuentenueva 3');

INSERT INTO estudiante VALUES
('11111111A', 'TUI001', 1, 1),
('22222222B', 'TUI002', 2, 2),
('55555555E', 'TUI003', 1, 2);

INSERT INTO profesor VALUES
('33333333C', 'Indefinido', 2400.50, 'Matemáticas'),
('44444444D', 'Temporal', 1900.00, 'Física');

INSERT INTO staff VALUES
('66666666F', 'Fijo', 1500.00);

INSERT INTO profesor_facultad VALUES
('33333333C', 1),
('44444444D', 3);

INSERT INTO deporte (nombre, max_jugadores, min_jugadores) VALUES
('Fútbol', 11, 7),
('Baloncesto', 12, 5);

INSERT INTO equipo (nombre, curso_inscripcion, id_centro_facultad, id_centro_colegio) VALUES
('Ingenieros FC', 2024, 1, 1),
('Medicina Basket', 2024, 2, 2),
('Ciencias United', 2024, 3, 1);

INSERT INTO torneo (ano, id_deporte, max_equipos, min_equipos, id_equipo_ganador) VALUES
(2024, 1, 16, 4, 1),
(2024, 2, 12, 4, 2);

INSERT INTO equipo_miembro VALUES
(1, '11111111A', TRUE),
(1, '55555555E', FALSE),
(2, '22222222B', TRUE);

INSERT INTO torneo_equipo VALUES
(1, 1),
(1, 3),
(2, 2);

INSERT INTO torneo_arbitros VALUES
(1, '66666666F'),
(2, '66666666F');

INSERT INTO partido (id_torneo, ubicacion, dni_arbitro, resultado, id_equipo_ganador) VALUES
(1, 'Pabellón A', '66666666F', '2-1', 1),
(1, 'Campo Central', '66666666F', '3-0', 3),
(2, 'Pabellón B', '66666666F', '78-65', 2);

INSERT INTO partido_equipo VALUES
(1, 1),
(1, 3),
(2, 3),
(2, 1),
(3, 3),
(3, 2);
